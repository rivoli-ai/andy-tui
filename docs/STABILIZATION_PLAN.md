# Andy.TUI Stabilization Plan\n\nThis document outlines a systematic approach to stabilize the Andy.TUI library, addressing persistent rendering issues despite strong architecture, tests, and debugging. The plan focuses on diagnosis, reliable testing, targeted fixes, and long-term maintenance.\n\n## Phase 1: Deep Diagnosis and Baseline Establishment (No Code Changes)\n\n- **Audit and Categorize Issues**: Create a centralized issue tracker (e.g., GitHub Issues or `KNOWN_ISSUES.md` in docs/). List problems with repro steps, screenshots, and code links. Prioritize by severity.\n\n- **Enhance Debugging Visibility**: Use existing logging with max detail for RENDERING, INPUT, LAYOUT. Add temporary buffer dumps for visual diffing.\n\n- **Validate Test Accuracy**: Manually repro failing tests and compare assertions to actual output. Identify gaps in mock terminals.\n\n## Phase 2: Strengthen Testing for Reliability\n\n- **Introduce Visual Regression Testing**: Use snapshot testing to capture and assert rendered output against baselines.\n\n- **Expand Integration Tests**: Build harnesses for examples, asserting on buffer states after interactions.\n\n- **Add Chaos/Stress Testing**: Simulate rapid updates to expose race conditions.\n\n## Phase 3: Targeted Refactoring and Unification\n\n- **Unify Rendering Paths**: Consolidate conflicting systems into one pipeline, validated by new tests.\n\n- **Fix Layer by Layer**: Address layout, virtual DOM, components, and theming incrementally.\n\n- **Performance and Stability Gates**: Require passing tests and manual validation after each fix.\n\n## Phase 4: Long-Term Stability and Maintenance\n\n- **CI/CD Integration**: Automate tests with visual diffs.\n\n- **Documentation Updates**: Expand TESTING_STRATEGY.md and NEXT_STEPS.md.\n\n- **Community/External Input**: Seek feedback via open-sourcing or comparisons.\n\n## Estimated Effort and Risks\n\n- **Time**: Phase 1 (1-2 days), Phase 2 (3-5 days), Phase 3 (1-2 weeks per fix), Phase 4 (ongoing).\n\n- **Risks**: Use branches for experiments; integrate emulators if needed.\n\nThis plan leverages existing strengths while targeting weaknesses for verifiable progress.